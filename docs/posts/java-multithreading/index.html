<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Java: L·∫≠p Tr√¨nh ƒêa Lu·ªìng C∆° B·∫£n | Profile</title>
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="icon" href="../../favicon.ico" type="image/x-icon">
</head>
<body>
  <header class="header">
  <div class="container">
    <div class="logo">
      <a href="../../">
        <span class="logo-icon">üè†</span>
        <span class="logo-text">Profile</span>
      </a>
    </div>
    
    <nav class="nav">
      <div class="search-container">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input type="text" id="headerSearchInput" class="header-search-input" placeholder="T√¨m ki·∫øm b√†i vi·∫øt...">
        <div id="searchDropdown" class="search-dropdown"></div>
      </div>
      
      <ul class="menu">
        
        <li><a href="../../#about">V·ªÅ t√¥i</a></li>
        
        <li><a href="../../#experience">Kinh nghi·ªám</a></li>
        
        <li><a href="../../#education">H·ªçc v·∫•n</a></li>
        
        <li><a href="../../#certificates">Ch·ª©ng ch·ªâ</a></li>
        
        <li><a href="../../#contact">Li√™n h·ªá</a></li>
        
        <li><a href="../../posts">Blog</a></li>
        
        <li><a href="../../#gallery">Th∆∞ vi·ªán ·∫£nh</a></li>
        
      </ul>
      
      <button class="theme-toggle" aria-label="Toggle dark mode" onclick="toggleTheme()">
        <span class="theme-icon"></span>
      </button>
    </nav>
  </div>
</header>

<script>
  
  function toggleTheme() {
    const html = document.documentElement;
    const currentTheme = html.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    html.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    updateThemeIcon();
  }

  function updateThemeIcon() {
    const theme = document.documentElement.getAttribute('data-theme');
    const icon = document.querySelector('.theme-icon');
    icon.textContent = theme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
  }

  
  (function() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    updateThemeIcon();
  })();

  let searchIndex = [];
  
  
  fetch('https:\/\/bao2482003.github.io\/22DTHC5-6_BaoDG_MBT\/index.json')
    .then(response => response.json())
    .then(data => {
      searchIndex = data;
      console.log('Search index loaded:', searchIndex.length, 'items');
    })
    .catch(error => console.error('Search index error:', error));

  
  const headerSearchInput = document.getElementById('headerSearchInput');
  const searchDropdown = document.getElementById('searchDropdown');

  headerSearchInput?.addEventListener('input', function(e) {
    const query = e.target.value.toLowerCase().trim();
    
    if (query.length < 2) {
      searchDropdown.style.display = 'none';
      return;
    }

    const results = searchIndex.filter(item => {
      return item.title.toLowerCase().includes(query) ||
             item.content.toLowerCase().includes(query) ||
             (item.tags && item.tags.some(tag => tag.toLowerCase().includes(query)));
    });

    if (results.length === 0) {
      searchDropdown.innerHTML = '<div class="dropdown-no-results">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</div>';
      searchDropdown.style.display = 'block';
      return;
    }

    const html = results.slice(0, 5).map(item => {
      const tagsHtml = item.tags ? item.tags.slice(0, 2).map(tag => `<span class="dropdown-tag">${tag}</span>`).join('') : '';
      
      return `
        <a href="${item.permalink}" class="dropdown-item">
          <div class="dropdown-title">${highlightText(item.title, query)}</div>
          <div class="dropdown-meta">
            <span class="dropdown-date">${formatDate(item.date)}</span>
            ${tagsHtml}
          </div>
        </a>
      `;
    }).join('');

    searchDropdown.innerHTML = html + (results.length > 5 ? `<div class="dropdown-more">C√≤n ${results.length - 5} k·∫øt qu·∫£...</div>` : '');
    searchDropdown.style.display = 'block';
  });

  
  document.addEventListener('click', function(e) {
    if (!e.target.closest('.search-container')) {
      searchDropdown.style.display = 'none';
    }
  });

  
  headerSearchInput?.addEventListener('focus', function() {
    if (this.value.trim().length >= 2) {
      searchDropdown.style.display = 'block';
    }
  });

  function highlightText(text, query) {
    const regex = new RegExp(`(${query})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
  }

  function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('vi-VN');
  }
</script>

  
  <main>
    <article class="blog-post">
  <div class="post-header">
    <div class="post-breadcrumb">
      <a href="../../posts">‚Üê T·∫•t c·∫£ b√†i vi·∫øt</a>
    </div>
    
    <h1 class="post-title">Java: L·∫≠p Tr√¨nh ƒêa Lu·ªìng C∆° B·∫£n</h1>
    
    
    <p class="post-description">T√¨m hi·ªÉu v·ªÅ multithreading v√† concurrency trong Java</p>
    
    
    <div class="post-meta">
      <div class="meta-left">
        <span class="post-date">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          27/12/2025
        </span>
        <span class="reading-time">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          9 ph√∫t ƒë·ªçc
        </span>
      </div>
      
      <div class="post-tags">
        
        <span class="post-tag">Java</span>
        
        <span class="post-tag">Concurrency</span>
        
      </div>
      
    </div>
  </div>

  
  <div class="post-featured-image">
    <img src="https://images.unsplash.com/photo-1518773553398-650c184e0bb3?w=1200&amp;h=600&amp;fit=crop" alt="Java: L·∫≠p Tr√¨nh ƒêa Lu·ªìng C∆° B·∫£n">
  </div>
  

  
  <div class="post-featured-video">
    <div class="video-wrapper">
      <iframe 
        src="https://www.youtube.com/embed/_SWK7pZQzIg" 
        title="YouTube video player" 
        frameborder="0" 
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
        referrerpolicy="strict-origin-when-cross-origin" 
        allowfullscreen>
      </iframe>
    </div>
  </div>
  

  <div class="post-content">
    <p>L·∫≠p tr√¨nh ƒëa lu·ªìng lu√¥n l√† m·ªôt ch·ªß ƒë·ªÅ ƒë∆∞·ª£c nhi·ªÅu l·∫≠p tr√¨nh vi√™n ch√∫ √Ω trong qu√° tr√¨nh ph√°t tri·ªÉn ph·∫ßn m·ªÅm, ph·∫£i l√†m sao ƒë·ªÉ ch∆∞∆°ng tr√¨nh c·ªßa m√¨nh ch·∫°y tr∆°n tru nh·∫•t, nh·∫π nh√†ng nh·∫•t ƒë·ªÉ ng∆∞·ªùi d√πng c√≥ thi·ªán c·∫£m t·ªët v·ªõi s·∫£n ph·∫©m c·ªßa m√¨nh. Trong b√†i vi·∫øt d∆∞·ªõi ƒë√¢y, ch√∫ng ta s·∫Ω c√πng t√¨m hi·ªÉu v·ªÅ l·∫≠p tr√¨nh ƒëa lu·ªìng v√† c√°c th·ª±c hi·ªán v·ªõi ng√¥n ng·ªØ Java.</p>
<ol>
<li>ƒêa lu·ªìng l√† g√¨ ?
Thread(lu·ªìng) l√† m·ªôt ti·∫øn tr√¨nh con(sub-process), m·ªôt ƒë∆°n v·ªã nh·ªè nh·∫•t c·ªßa m√°y t√≠nh c√≥ th·ªÉ th·ª±c hi·ªán m·ªôt c√¥ng vi·ªác ri√™ng bi·ªát. ƒêa ti·∫øn tr√¨nh v√† ƒëa lu·ªìng l√† c√°c c√°ch ƒë·ªÉ ƒë·∫°t ƒë∆∞·ª£c ƒëa nhi·ªám. Trong Java, c√°c lu·ªìng ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi m√°y ·∫£o Java(JVM)</li>
</ol>
<p>L·ª£i √≠ch c·ªßa ƒëa lu·ªìng
ƒêa lu·ªìng kh√¥ng ch·∫∑n ng∆∞·ªùi d√πng v√¨ c√°c lu·ªìng l√† ƒë·ªôc l·∫≠p v√† b·∫°n c√≥ th·ªÉ th·ª±c hi·ªán nhi·ªÅu h√†nh ƒë·ªông t·∫°i m·ªôt th·ªùi ƒëi·ªÉm</p>
<p>C√≥ th·ªÉ ti·∫øt ki·ªám th·ªùi gian v√¨ c√≥ th·ªÉ th·ª±c hi·ªán nhi·ªÅu h√†nh ƒë·ªông ƒë·ªìng th·ªùi</p>
<p>C√°c lu·ªìng ƒë·ªôc l·∫≠p n√™n n√≥ s·∫Ω kh√¥ng g√¢y ·∫£nh h∆∞·ªüng t·ªõi c√°c lu·ªìng kh√°c n·∫øu exception x·∫£y ra t·∫°i m·ªôt lu·ªìng</p>
<p>C√°c lu·ªìng c√≥ th·ªÉ d√πng chung v√† chia s·∫ª ngu·ªìn t√†i nguy√™n trong qu√° tr√¨nh ch·∫°y, tuy nhi√™n c√°c lu·ªìng v·∫´n s·∫Ω ho·∫°t ƒë·ªông ƒë·ªôc l·∫≠p v·ªõi nhau</p>
<p>Nh∆∞·ª£c ƒëi·ªÉm c·ªßa ƒëa lu·ªìng
X·ª≠ l√Ω ch∆∞∆°ng tr√¨nh ph·ª©c t·∫°p</p>
<p>X·ª≠ l√Ω v·∫•n ƒë·ªÅ tranh ch·∫•p b·ªô nh·ªõ, ƒë·ªìng b·ªô d·ªØ li·ªáu kh√° ph·ª©c t·∫°p</p>
<p>C·∫ßn ph√°t hi·ªán c√°c lu·ªìng b·ªã ch·∫∑n, block(dead lock) ƒë·ªÉ tr√°nh g√¢y l·ªói cho h·ªá th·ªëng</p>
<ol start="2">
<li>ƒêa nhi·ªám l√† g√¨ ?
ƒêa nhi·ªám l√† kh·∫£ nƒÉng ch·∫°y ƒë·ªìng th·ªùi m·ªôt hay nhi·ªÅu ch∆∞∆°ng tr√¨nh c√πng l√∫c tr√™n m·ªôt h·ªá ƒëi·ªÅu h√†nh. Ch√∫ng ta d√πng ƒëa nhi·ªám ƒë·ªÉ t·ªëi ∆∞u vi·ªác s·ª≠ d·ª•ng t√†i nguy√™n CPU. ƒêa nhi·ªám c√≥ th·ªÉ ƒë·∫°t ƒë∆∞·ª£c qua hai c√°ch:</li>
</ol>
<p>ƒêa nhi·ªám d·ª±a tr√™n ƒëa ti·∫øn tr√¨nh(Multiprocessing)
M·ªói ti·∫øn tr√¨nh c√≥ m·ªôt ƒë·ªãa ch·ªâ trong b·ªô nh·ªõ, m·ªói ti·∫øn tr√¨nh c√≥ m·ªôt b·ªô nh·ªõ ri√™ng bi·ªát</p>
<p>M·ªôt ti·∫øn tr√¨nh l√† n·∫∑ng</p>
<p>S·ª± giao ti·∫øp gi·ªØa c√°c ti·∫øn tr√¨nh c√≥ chi ph√≠ cao</p>
<p>S·ª± chuy·ªÉn ƒë·ªïi gi·ªØa m·ªôt ti·∫øn tr√¨nh sang ti·∫øn tr√¨nh kh√°c ƒë√≤i h·ªèi th·ªùi gian cho vi·ªác l∆∞u v√† t·∫£i c√°c v√πng ƒëƒÉng k√Ω b·ªô nh·ªõ, danh s√°ch, &hellip;</p>
<p>ƒêa nhi·ªám d·ª±a tr√™n ƒëa lu·ªìng(Multithreading)
Lu·ªìng s·ª≠ d·ª•ng chung v√πng nh·ªõ</p>
<p>Lu·ªìng l√† nh·∫π</p>
<p>Chi ph√≠ giao ti·∫øp gi·ªØa c√°c lu·ªìng l√† kh√¥ng cao</p>
<ol start="3">
<li>V√≤ng ƒë·ªùi c·ªßa m·ªôt Thread trong Java
M·ªôt Thread s·∫Ω tr·∫£i qua nƒÉm tr·∫°ng th√°i trong v√≤ng ƒë·ªùi c·ªßa n√≥. V√≤ng ƒë·ªùi c·ªßa lu·ªìng ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi JVM bao g·ªìm c√≥:</li>
</ol>
<p>NEW : ƒê√¢y l√† tr·∫°ng th√°i khi lu·ªìng v·ª´a ƒë∆∞·ª£c kh·ªüi t·∫°o b·∫±ng ph∆∞∆°ng th·ª©c kh·ªüi t·∫°o c·ªßa l·ªõp Thread nh∆∞ng ch∆∞a ƒë∆∞·ª£c start(). ·ªû tr·∫°ng th√°i n√†y, lu·ªìng ƒë∆∞·ª£c t·∫°o ra nh∆∞ng ch∆∞a ƒë∆∞·ª£c c·∫•p ph√°t t√†i nguy√™n v√† c≈©ng ch∆∞a ch·∫°y. N·∫øu lu·ªìng ƒëang ·ªü tr·∫°ng th√°i n√†y m√† ta g·ªçi c√°c ph∆∞∆°ng th·ª©c √©p bu·ªôc stop,resume,suspend ‚Ä¶ s·∫Ω l√† nguy√™n nh√¢n s·∫£y ra ngo·∫°i l·ªá IllegalThreadStateException .</p>
<p>RUNNABLE : Sau khi g·ªçi ph∆∞∆°ng th·ª©c start() th√¨ lu·ªìng test ƒë√£ ƒë∆∞·ª£c c·∫•p ph√°t t√†i nguy√™n v√† c√°c l·ªãch ƒëi·ªÅu ph·ªëi CPU cho lu·ªìng test c≈©ng b·∫Øt ƒë·∫ßu c√≥ hi·ªáu l·ª±c. ·ªû ƒë√¢y, ch√∫ng ta d√πng tr·∫°ng th√°i l√† Runnable ch·ª© kh√¥ng ph·∫£i Running, v√¨ lu·ªìng kh√¥ng th·ª±c s·ª± lu√¥n ch·∫°y m√† t√πy v√†o h·ªá th·ªëng m√† c√≥ s·ª± ƒëi·ªÅu ph·ªëi CPU kh√°c nhau.</p>
<p>WAITING : Thread ch·ªù kh√¥ng gi·ªõi h·∫°n cho ƒë·∫øn khi m·ªôt lu·ªìng kh√°c ƒë√°nh th·ª©c n√≥.</p>
<p>TIMED_WAITING : Thread ch·ªù trong m·ªôt th·ªùi gian nh·∫•t ƒë·ªãnh, ho·∫∑c l√† c√≥ m·ªôt lu·ªìng kh√°c ƒë√°nh th·ª©c n√≥.</p>
<p>BLOCKED: ƒê√¢y l√† 1 d·∫°ng c·ªßa tr·∫°ng th√°i ‚ÄúNot Runnable‚Äù, l√† tr·∫°ng th√°i khi Thread v·∫´n c√≤n s·ªëng, nh∆∞ng hi·ªán t·∫°i kh√¥ng ƒë∆∞·ª£c ch·ªçn ƒë·ªÉ ch·∫°y. Thread ch·ªù m·ªôt monitor ƒë·ªÉ unlock m·ªôt ƒë·ªëi t∆∞·ª£ng m√† n√≥ c·∫ßn.</p>
<p>TERMINATED : M·ªôt thread ·ªü trong tr·∫°ng th√°i terminated ho·∫∑c dead khi ph∆∞∆°ng th·ª©c run() c·ªßa n√≥ b·ªã tho√°t.</p>
<ol start="4">
<li>L·ªõp Thread trong Java
Trong Java, ch√∫ng ta c√≥ th·ªÉ t·∫°o ra m·ªôt lu·ªìng b·∫±ng c√°ch t·∫°o m·ªôt ƒë·ªëi t∆∞·ª£ng t·ª´ m·ªôt l·ªõp k·∫ø th·ª´a l·ªõp Thread. ƒê·ªÉ kh·ªüi t·∫°o m·ªôt lu·ªìng b·∫±ng c√°ch n√†y, ch√∫ng ta s·∫Ω ph·∫£i th·ª±c hi·ªán c√°c b∆∞·ªõc sau:</li>
</ol>
<p>Khai b√°o m·ªôt l·ªõp k·∫ø th·ª´a l·ªõp Thread</p>
<p>Override l·∫°i ph∆∞∆°ng th·ª©c run() c·ªßa l·ªõp n√†y, c√°c d√≤ng l·ªánh trong ph∆∞∆°ng th·ª©c n√†y s·∫Ω ƒë∆∞·ª£c th·ª±c thi khi lu·ªìng b·∫Øt ƒë·∫ßu ch·∫°y. Sau khi lu·ªìng ƒë√£ th·ª±c hi·ªán xong c√°c d√≤ng code trong ph∆∞∆°ng th·ª©c run th√¨ lu·ªìng s·∫Ω chuy·ªÉn sang tr·∫°ng th√°i h·ªßy.</p>
<p>T·∫°o m·ªôt ƒë·ªëi t∆∞·ª£ng c·ªßa l·ªõp v·ª´a khai b√°o.</p>
<p>G·ªçi ph∆∞∆°ng th·ª©c start() ƒë·ªÉ b·∫Øt ƒë·∫ßu th·ª±c thi lu·ªìng.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ThreadSample</span> <span style="color:#66d9ef">extends</span> Thread{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span>() {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;This is a thread, myThreadName: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>T·∫°i sao g·ªçi ph∆∞∆°ng th·ª©c start() ch·ª© kh√¥ng ph·∫£i run() ƒë·ªÉ th·ª±c thi lu·ªìng?</p>
<p>Ph∆∞∆°ng th·ª©c start() l√† ph∆∞∆°ng th·ª©c ƒë·∫∑c bi·ªát ƒë∆∞·ª£c Oracle x√¢y d·ª±ng trong l·ªõp Thread, ph∆∞∆°ng th·ª©c n√†y s·∫Ω c·∫•p ph√°t t√†i nguy√™n cho lu·ªìng r·ªìi m·ªõi th·ª±c thi ph∆∞∆°ng th·ª©c run() ·ªü lu·ªìng n√†y.</p>
<p>Do ƒë√≥, n·∫øu ta g·ªçi ph∆∞∆°ng th·ª©c run() th√¨ c≈©ng t∆∞∆°ng ƒë∆∞∆°ng v·ªõi vi·ªác g·ªçi m·ªôt ph∆∞∆°ng th·ª©c ·ªü m·ªôt l·ªõp b√¨nh th∆∞·ªùng v√† n√≥ s·∫Ω ch·∫°y tr√™n lu·ªìng th·ª±c hi·ªán g·ªçi ph∆∞∆°ng th·ª©c ch·ª© kh√¥ng sinh ra m·ªôt lu·ªìng m·ªõi.</p>
<p>Th√™m m·ªôt l∆∞u √Ω n·ªØa, b·∫°n kh√¥ng th·ªÉ g·ªçi ph∆∞∆°ng th·ª©c start() c·ªßa Thread hai l·∫ßn, n·∫øu kh√¥ng s·∫Ω c√≥ ngo·∫°i l·ªá IllegalThreadStateException x·∫£y ra.</p>
<ol start="5">
<li>Interface Runnable trong Java
Ngo√†i c√°ch s·ª≠ k·∫ø th·ª´a l·ªõp Thread trong Java, b·∫°n ho√†n to√†n c√≥ th·ªÉ s·ª≠ d·ª•ng interface Runnable trong Java ƒë·ªÉ kh·ªüi t·∫°o m·ªôt lu·ªìng m·ªõi. ƒê·ªÉ t·∫°o lu·ªìng b·∫±ng c√°ch s·ª≠ d·ª•ng Runnable, ta ph·∫£i l√†m c√°c c√¥ng vi·ªác sau:</li>
</ol>
<p>Khai b√°o m·ªôt l·ªõp implement Runnable</p>
<p>Override l·∫°i ph∆∞∆°ng th·ª©c run() trong l·ªõp n√†y. Vi·ªác n√†y t∆∞∆°ng t·ª± v·ªõi vi·ªác override l·∫°i ph∆∞∆°ng th·ª©c run() trong c√°ch s·ª≠ d·ª•ng l·ªõp Thread</p>
<p>T·∫°o m·ªôt ƒë·ªëi t∆∞·ª£ng c·ªßa l·ªõp v·ª´a khai b√°o</p>
<p>T·∫°o m·ªôt ƒë·ªëi t∆∞·ª£ng Thread b·∫±ng constructor: Thread(Runnable runnable). ƒêi·ªÅu th√∫ v·ªã ·ªü ƒë√¢y l√†, m·∫∑c d√π ch√∫ng ta v·∫´n c·∫ßn m·ªôt ƒë·ªëi t∆∞·ª£ng Thread ƒë·ªÉ kh·ªüi t·∫°o lu·ªìng m·ªõi, tuy nhi√™n thay v√¨ vi·ªác override l·∫°i ph∆∞∆°ng th·ª©c run() c·ªßa n√≥ th√¨ ch√∫ng ta l·∫°i truy·ªÅn v√†o ƒë√¢y m·ªôt Runnable v·ªõi c√°c d√≤ng code th·ª±c thi ch∆∞∆°ng tr√¨nh ƒë√£ ƒë∆∞·ª£c th√™m v√†o trong ph∆∞∆°ng th·ª©c run()</p>
<p>G·ªçi ph∆∞∆°ng th·ª©c start() ƒë·ªÉ b·∫Øt ƒë·∫ßu th·ª±c thi lu·ªìng</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PingWorker</span> <span style="color:#66d9ef">implements</span> Runnable {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Logger LOGGER <span style="color:#f92672">=</span> LogManager.<span style="color:#a6e22e">getLogger</span>(<span style="color:#e6db74">&#34;PingWorker&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">long</span> TIMEOUT_PING <span style="color:#f92672">=</span> 30 <span style="color:#f92672">*</span> 1000L;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span>() {
</span></span><span style="display:flex;"><span>        LOGGER.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Start ping worker !&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>) {
</span></span><span style="display:flex;"><span>            Packet pingPacket <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Packet();
</span></span><span style="display:flex;"><span>            pingPacket.<span style="color:#a6e22e">setServiceType</span>(Constants.<span style="color:#a6e22e">PacketServiceType</span>.<span style="color:#a6e22e">PING</span>);
</span></span><span style="display:flex;"><span>            pingPacket.<span style="color:#a6e22e">setBody</span>(<span style="color:#66d9ef">new</span> JSONObject());
</span></span><span style="display:flex;"><span>            List<span style="color:#f92672">&lt;</span>Connection<span style="color:#f92672">&gt;</span> allConnections <span style="color:#f92672">=</span> ConnectionManager.<span style="color:#a6e22e">getInstance</span>().<span style="color:#a6e22e">getAllConnections</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (Connection connection : allConnections) {
</span></span><span style="display:flex;"><span>                connection.<span style="color:#a6e22e">sendPacket</span>(pingPacket);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                TimeUnit.<span style="color:#a6e22e">SECONDS</span>.<span style="color:#a6e22e">sleep</span>(30);
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>                LOGGER.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#34;Error  when trying to sleep &#34;</span>, ex);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Khi n√†o th√¨ n√™n d√πng Runnable
V√¨ Runnable l√† m·ªôt interface n√™n n√≥ c√≥ th·ªÉ gi√∫p ch√∫ng ta gi·∫£i quy·∫øt b√†i to√°n ƒëa k·∫ø th·ª´a. Ngo√†i ra, Thread Pool c≈©ng ch·∫•p nh·∫≠n c√°c ƒë·ªëi t∆∞·ª£ng ƒë·ªÉ n√≥ qu·∫£n l√Ω l√† Runnable, vi·ªác s·ª≠ d·ª•ng Thread Pool mang l·∫°i nhi·ªÅu hi·ªáu qu·∫£ trong vi·ªác qu·∫£n l√Ω c√°c lu·ªìng</p>
<p>Trong c√°c tr∆∞·ªùng h·ª£p c√≤n l·∫°i, b·∫°n ho√†n to√†n c√≥ th·ªÉ s·ª≠ d·ª•ng Thread</p>
<ol start="6">
<li>V√≠ d·ª• minh h·ªça s·ª≠ d·ª•ng ƒëa lu·ªìng
T·∫°o lu·ªìng v·ªõi Thread</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ThreadSample</span> <span style="color:#66d9ef">extends</span> Thread{
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span>() {
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;This is a thread, myThreadName: &#34;</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        ThreadSample thread <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ThreadSample();
</span></span><span style="display:flex;"><span>        ThreadSample thread2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ThreadSample();
</span></span><span style="display:flex;"><span>        ThreadSample thread3 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ThreadSample();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;CurrentThread &#34;</span> <span style="color:#f92672">+</span> Thread.<span style="color:#a6e22e">currentThread</span>().<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        thread.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>        thread2.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>        thread3.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Output ch∆∞∆°ng tr√¨nh:</strong></p>
<pre tabindex="0"><code>CurrentThread main
This is a thread, myThreadName: Thread-0
This is a thread, myThreadName: Thread-2
This is a thread, myThreadName: Thread-1
</code></pre><p>T·∫°o lu·ªìng v·ªõi interface Runnable</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">RunnableSample</span> <span style="color:#66d9ef">implements</span> Runnable {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">long</span> timestamp <span style="color:#f92672">=</span> System.<span style="color:#a6e22e">currentTimeMillis</span>();
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;[%s]Checking timestamp%n&#34;</span>, Thread.<span style="color:#a6e22e">currentThread</span>().<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">printf</span>(<span style="color:#e6db74">&#34;[%s]My timestamp: %d%n&#34;</span>, Thread.<span style="color:#a6e22e">currentThread</span>().<span style="color:#a6e22e">getName</span>(), timestamp);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        Thread thread1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread(<span style="color:#66d9ef">new</span> RunnableSample());
</span></span><span style="display:flex;"><span>        Thread thread2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread(<span style="color:#66d9ef">new</span> RunnableSample());
</span></span><span style="display:flex;"><span>        Thread thread3 <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread(<span style="color:#66d9ef">new</span> RunnableSample());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        thread1.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>        thread2.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>        thread3.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><strong>Output ch∆∞∆°ng tr√¨nh:</strong></p>
<pre tabindex="0"><code>[Thread-2]Checking timestamp
[Thread-0]Checking timestamp
[Thread-0]My timestamp: 1687795285576
[Thread-1]Checking timestamp
[Thread-1]My timestamp: 1687795285576
[Thread-2]My timestamp: 1687795285576
</code></pre><ol start="7">
<li>C√°c ph∆∞∆°ng th·ª©c c·ªßa l·ªõp Thread th∆∞·ªùng ƒë∆∞·ª£c hay s·ª≠ d·ª•ng</li>
</ol>
<table>
  <thead>
      <tr>
          <th>Ki·ªÉu tr·∫£ v·ªÅ</th>
          <th>T√™n ph∆∞∆°ng th·ª©c</th>
          <th>M√¥ t·∫£</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>void</td>
          <td>start()</td>
          <td>ƒê∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ b·∫Øt ƒë·∫ßu th·ª±c thi m·ªôt lu·ªìng</td>
      </tr>
      <tr>
          <td>void</td>
          <td>run()</td>
          <td>ƒê∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ch·∫°y h√†nh ƒë·ªông c·ªßa m·ªôt lu·ªìng</td>
      </tr>
      <tr>
          <td>static void</td>
          <td>sleep()</td>
          <td>Ngh·ªâ m·ªôt lu·ªìng trong m·ªôt kho·∫£ng th·ªùi gian</td>
      </tr>
      <tr>
          <td>static Thread</td>
          <td>currentThread()</td>
          <td>Tr·∫£ v·ªÅ tham chi·∫øu t·ªõi lu·ªìng ƒëang th·ª±c thi ƒë·ªëi t∆∞·ª£ng Thread</td>
      </tr>
      <tr>
          <td>void</td>
          <td>join()</td>
          <td>Ch·ªù m·ªôt thread ho√†n th√†nh v√≤ng ƒë·ªùi c·ªßa n√≥</td>
      </tr>
      <tr>
          <td>int</td>
          <td>getPriority()</td>
          <td>Tr·∫£ v·ªÅ gi√° tr·ªã ∆∞u ti√™n c·ªßa lu·ªìng</td>
      </tr>
      <tr>
          <td>void</td>
          <td>setPriority(int)</td>
          <td>Thay ƒë·ªïi gi√° tr·ªã ∆∞u ti√™n c·ªßa lu·ªìng</td>
      </tr>
      <tr>
          <td>String</td>
          <td>getName()</td>
          <td>Tr·∫£ v·ªÅ t√™n c·ªßa lu·ªìng</td>
      </tr>
      <tr>
          <td>void</td>
          <td>setName(String)</td>
          <td>Thay ƒë·ªïi t√™n c·ªßa lu·ªìng</td>
      </tr>
      <tr>
          <td>long</td>
          <td>getId()</td>
          <td>Tr·∫£ v·ªÅ id c·ªßa lu·ªìng</td>
      </tr>
      <tr>
          <td>boolean</td>
          <td>isAlive()</td>
          <td>Cho bi·∫øt thread c√≤n s·ªëng hay kh√¥ng</td>
      </tr>
      <tr>
          <td>static void</td>
          <td>yield()</td>
          <td>L√†m cho lu·ªìng hi·ªán t·∫°i t·∫°m d·ª´ng v√† cho ph√©p c√°c thread kh√°c th·ª±c hi·ªán trong m·ªôt kho·∫£ng th·ªùi gian</td>
      </tr>
      <tr>
          <td>void</td>
          <td>suspend()</td>
          <td>ƒê∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ t·∫°m d·ª´ng m·ªôt lu·ªìng</td>
      </tr>
      <tr>
          <td>void</td>
          <td>resume()</td>
          <td>ƒê∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ti·∫øp t·ª•c lu·ªìng ƒë√£ b·ªã t·∫°m d·ª´ng</td>
      </tr>
      <tr>
          <td>void</td>
          <td>stop()</td>
          <td>ƒê∆∞·ª£c d√πng ƒë·ªÉ d·ª´ng thread</td>
      </tr>
      <tr>
          <td>void</td>
          <td>destroy()</td>
          <td>D√πng ƒë·ªÉ ph√° h·ªßy c√°c nh√≥m lu·ªìng v√† c√°c nh√≥m con c·ªßa n√≥</td>
      </tr>
      <tr>
          <td>boolean</td>
          <td>isDaemon()</td>
          <td>Ki·ªÉm tra xem lu·ªìng n√†y c√≥ ph·∫£i l√† daemon thread hay kh√¥ng</td>
      </tr>
      <tr>
          <td>void</td>
          <td>setDaemon(boolean)</td>
          <td>Thay ƒë·ªïi vi·ªác lu·ªìng c√≥ ph·∫£i l√† daemon hay kh√¥ng</td>
      </tr>
      <tr>
          <td>void</td>
          <td>interrupt()</td>
          <td>L√†m gi√°n ƒëo·∫°n m·ªôt lu·ªìng trong java. N·∫øu thread n·∫±m trong tr·∫°ng th√°i sleep ho·∫∑c wait, nghƒ©a l√† sleep() ho·∫∑c wait() ƒë∆∞·ª£c g·ªçi ra. Vi·ªác g·ªçi ph∆∞∆°ng th·ª©c interrupt() tr√™n thread ƒë√≥ s·∫Ω ph√° v·ª° tr·∫°ng th√°i sleep ho·∫∑c wait v√† n√©m ra ngo·∫°i l·ªá InterruptedException. N·∫øu thread kh√¥ng ·ªü trong tr·∫°ng th√°i sleep ho·∫∑c wait, vi·ªác g·ªçi ph∆∞∆°ng th·ª©c interrupt() th·ª±c hi·ªán h√†nh vi b√¨nh th∆∞·ªùng v√† kh√¥ng l√†m gi√°n ƒëo·∫°n thread nh∆∞ng ƒë·∫∑t c·ªù interrupt th√†nh true.</td>
      </tr>
      <tr>
          <td>boolean</td>
          <td>isInterrupted()</td>
          <td>Ki·ªÉm tra xem lu·ªìng c√≥ b·ªã interrupt hay kh√¥ng</td>
      </tr>
      <tr>
          <td>static boolean</td>
          <td>interrupted()</td>
          <td>Ki·ªÉm tra xem lu·ªìng hi·ªán t·∫°i c√≥ b·ªã interrupt hay ch∆∞a</td>
      </tr>
  </tbody>
</table>
<p><strong>K·∫øt lu·∫≠n</strong></p>
<p>L·∫≠p tr√¨nh ƒëa lu·ªìng Java mang l·∫°i nhi·ªÅu l·ª£i √≠ch nh∆∞ tƒÉng hi·ªáu su·∫•t v√† t·∫≠n d·ª•ng t√†i nguy√™n h·ªá th·ªëng. Tuy nhi√™n, vi·ªác qu·∫£n l√Ω v√† ƒë·ªìng b·ªô h√≥a lu·ªìng ƒë√≤i h·ªèi k·ªπ nƒÉng ch√≠nh x√°c v√† ph·∫£i tr√°nh c√°c v·∫•n ƒë·ªÅ nh∆∞ data race v√† deadlock. Trong b√†i vi·∫øt n√†y, Stringee ƒë√£ gi√∫p c√°c b·∫°n c√≥ ƒë∆∞·ª£c c√°c ki·∫øn th·ª©c v·ªÅ l·∫≠p tr√¨nh ƒëa lu·ªìng v·ªõi Java, trong c√°c b√†i vi·∫øt ti·∫øp theo c·ªßa series l·∫≠p tr√¨nh ƒëa lu·ªìng, ch√∫ng ta s·∫Ω t√¨m hi·ªÉu v·ªÅ c√°ch ph√≤ng tr√°nh deadlock v√† data race c≈©ng nh∆∞ c√°c k·ªπ thu·∫≠t l·∫≠p tr√¨nh ƒëa lu·ªìng kh√°c.</p>

  </div>

  
  <div class="comments-section">
    <h3 class="comments-title">üí¨ B√¨nh lu·∫≠n <span id="commentCount"></span></h3>
    
    
    <div class="comment-form">
      <input type="text" id="commentName" placeholder="T√™n c·ªßa b·∫°n" maxlength="50">
      <textarea id="commentText" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." rows="3" maxlength="500"></textarea>
      <button onclick="addComment()" class="submit-comment">G·ª≠i b√¨nh lu·∫≠n</button>
    </div>

    
    <div class="comment-filter">
      <button onclick="filterComments('top')" class="filter-btn active" id="filter-top">üëç Ch·∫•t l∆∞·ª£ng nh·∫•t</button>
      <button onclick="filterComments('newest')" class="filter-btn" id="filter-newest">üïê M·ªõi nh·∫•t</button>
    </div>

    
    <div id="commentsList" class="comments-list"></div>
    
    <button id="showAllBtn" class="show-all-btn" onclick="showAllComments()" style="display:none;">
      Xem t·∫•t c·∫£ b√¨nh lu·∫≠n
    </button>
  </div>

  
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

  <script>
    
    const firebaseConfig = {
  apiKey: "AIzaSyAdjhCEVyCd-Lr5M6wIrcVIdUGZK5nnMRQ",
  authDomain: "project-profile-e5576.firebaseapp.com",
  databaseURL: "https://project-profile-e5576-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "project-profile-e5576",
  storageBucket: "project-profile-e5576.firebasestorage.app",
  messagingSenderId: "141833177870",
  appId: "1:141833177870:web:510eb87ec5b5749d9e255f",
  measurementId: "G-8EZ42LZQ09"
};

    
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    const POST_ID = '\/posts\/java-multithreading\/'.replace(/\//g, '_');
    let currentFilter = 'top';
    let showAll = false;
    let commentsCache = [];

    function getComments() {
      return commentsCache;
    }

    function loadCommentsFromFirebase() {
      const commentsRef = database.ref('comments/' + POST_ID);
      commentsRef.on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
          commentsCache = Object.values(data).map(comment => ({
            ...comment,
            likedBy: comment.likedBy || [],
            likes: comment.likes || 0
          }));
        } else {
          commentsCache = [];
        }
        renderComments();
      });
    }

    function addComment() {
      const name = document.getElementById('commentName').value.trim();
      const text = document.getElementById('commentText').value.trim();
      
      if (!name || !text) {
        alert('Vui l√≤ng nh·∫≠p t√™n v√† n·ªôi dung b√¨nh lu·∫≠n!');
        return;
      }

      const newComment = {
        id: Date.now(),
        name: name,
        text: text,
        likes: 0,
        timestamp: new Date().toISOString(),
        likedBy: []
      };

      
      const commentsRef = database.ref('comments/' + POST_ID);
      commentsRef.push(newComment).then(() => {
        document.getElementById('commentName').value = '';
        document.getElementById('commentText').value = '';
      }).catch((error) => {
        alert('L·ªói khi g·ª≠i b√¨nh lu·∫≠n: ' + error.message);
      });
    }

    function likeComment(commentId) {
      const userId = getUserId();
      const commentsRef = database.ref('comments/' + POST_ID);
      
      commentsRef.once('value').then((snapshot) => {
        const comments = snapshot.val();
        if (!comments) return;
        
        
        let commentKey = null;
        let comment = null;
        
        Object.keys(comments).forEach(key => {
          if (comments[key].id === commentId) {
            commentKey = key;
            comment = comments[key];
          }
        });
        
        if (comment && commentKey) {
          const likedBy = comment.likedBy || [];
          const likedIndex = likedBy.indexOf(userId);
          
          if (likedIndex > -1) {
            likedBy.splice(likedIndex, 1);
            comment.likes = Math.max(0, (comment.likes || 0) - 1);
          } else {
            likedBy.push(userId);
            comment.likes = (comment.likes || 0) + 1;
          }
          
          comment.likedBy = likedBy;
          
          
          database.ref('comments/' + POST_ID + '/' + commentKey).set(comment);
        }
      });
    }

    function getUserId() {
      let userId = localStorage.getItem('userId');
      if (!userId) {
        userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('userId', userId);
      }
      return userId;
    }

    function formatDate(timestamp) {
      const date = new Date(timestamp);
      const now = new Date();
      const diff = Math.floor((now - date) / 1000);

      if (diff < 60) return 'v·ª´a xong';
      if (diff < 3600) return Math.floor(diff / 60) + ' ph√∫t tr∆∞·ªõc';
      if (diff < 86400) return Math.floor(diff / 3600) + ' gi·ªù tr∆∞·ªõc';
      if (diff < 2592000) return Math.floor(diff / 86400) + ' ng√†y tr∆∞·ªõc';
      
      return date.toLocaleDateString('vi-VN');
    }

    function filterComments(filter) {
      currentFilter = filter;
      
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById('filter-' + filter).classList.add('active');
      
      renderComments();
    }

    function showAllComments() {
      showAll = true;
      renderComments();
    }

    function renderComments() {
      let comments = getComments();
      
      
      const countSpan = document.getElementById('commentCount');
      if (comments.length > 0) {
        countSpan.textContent = `(${comments.length})`;
      } else {
        countSpan.textContent = '';
      }
      
      if (currentFilter === 'top') {
        comments.sort((a, b) => b.likes - a.likes);
      } else {
        comments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      }

      const userId = getUserId();
      const displayComments = showAll ? comments : comments.slice(0, 3);
      
      const html = displayComments.map(comment => {
        const likedBy = comment.likedBy || [];
        const likes = comment.likes || 0;
        const hasLiked = likedBy.includes(userId);
        return `
          <div class="comment-item">
            <div class="comment-avatar">${comment.name.charAt(0).toUpperCase()}</div>
            <div class="comment-content">
              <div class="comment-header">
                <strong>${comment.name}</strong>
                <span class="comment-time">${formatDate(comment.timestamp)}</span>
              </div>
              <p class="comment-text">${comment.text}</p>
              <button onclick="likeComment(${comment.id})" class="like-btn ${hasLiked ? 'liked' : ''}">
                ‚ù§Ô∏è ${likes}
              </button>
            </div>
          </div>
        `;
      }).join('');

      document.getElementById('commentsList').innerHTML = html || '<p class="no-comments">Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>';
      
      const showAllBtn = document.getElementById('showAllBtn');
      if (comments.length > 3 && !showAll) {
        showAllBtn.style.display = 'block';
        showAllBtn.textContent = `Xem t·∫•t c·∫£ ${comments.length} b√¨nh lu·∫≠n`;
      } else {
        showAllBtn.style.display = 'none';
      }
    }

    
    loadCommentsFromFirebase();
  </script>

  <div class="post-footer">
    <a href="../../posts" class="back-to-blog">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      Xem t·∫•t c·∫£ b√†i vi·∫øt
    </a>
  </div>
</article>
  </main>
  
  <footer class="footer">
  <div class="container">
    <p>&copy; 2025 D∆∞∆°ng Gia B·∫£o. All rights reserved.</p>
  </div>
</footer>

</body>
</html>
