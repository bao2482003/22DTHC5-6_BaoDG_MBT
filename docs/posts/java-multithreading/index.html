<!doctype html><html lang=vi><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Java Multithreading: L·∫≠p tr√¨nh ƒëa lu·ªìng c∆° b·∫£n | Profile</title><link rel=stylesheet href=../../css/style.css><link rel=icon href=../../favicon.ico type=image/x-icon></head><body><header class=header><div class=container><div class=logo><a href=../../><span class=logo-icon>üè†</span>
<span class=logo-text>Profile</span></a></div><nav class=nav><div class=search-box><span>T√¨m ki·∫øm...</span></div><ul class=menu><li><a href=../../#about>V·ªÅ t√¥i</a></li><li><a href=../../#experience>Kinh nghi·ªám</a></li><li><a href=../../#education>H·ªçc v·∫•n</a></li><li><a href=../../#certificates>Ch·ª©ng ch·ªâ</a></li><li><a href=../../#contact>Li√™n h·ªá</a></li><li><a href=../../posts>Blog</a></li><li><a href=../../#gallery>Th∆∞ vi·ªán ·∫£nh</a></li></ul><button class=theme-toggle aria-label="Toggle dark mode">üåô</button></nav></div></header><main><h1>Java Multithreading: L·∫≠p tr√¨nh ƒëa lu·ªìng c∆° b·∫£n</h1><time datetime=2024-11-18T00:00:00+00:00>November 18, 2024</time><h2 id=thread-l√†-g√¨>Thread l√† g√¨?</h2><p>Thread l√† ƒë∆°n v·ªã nh·ªè nh·∫•t c·ªßa m·ªôt process, cho ph√©p ch∆∞∆°ng tr√¨nh th·ª±c hi·ªán nhi·ªÅu t√°c v·ª• ƒë·ªìng th·ªùi.</p><h2 id=t·∫°o-thread-trong-java>T·∫°o Thread trong Java</h2><h3 id=c√°ch-1-extends-thread>C√°ch 1: Extends Thread</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyThread</span> <span style=color:#66d9ef>extends</span> Thread {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 5; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>getName</span>() <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;: &#34;</span> <span style=color:#f92672>+</span> i);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>        Thread.<span style=color:#a6e22e>sleep</span>(1000);
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>        e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// S·ª≠ d·ª•ng</span>
</span></span><span style=display:flex><span>MyThread thread1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyThread();
</span></span><span style=display:flex><span>MyThread thread2 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> MyThread();
</span></span><span style=display:flex><span>thread1.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>thread2.<span style=color:#a6e22e>start</span>();
</span></span></code></pre></div><h3 id=c√°ch-2-implements-runnable-recommended>C√°ch 2: Implements Runnable (Recommended)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyTask</span> <span style=color:#66d9ef>implements</span> Runnable {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 5; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>getName</span>() <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;: &#34;</span> <span style=color:#f92672>+</span> i);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>        Thread.<span style=color:#a6e22e>sleep</span>(1000);
</span></span><span style=display:flex><span>      } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>        e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// S·ª≠ d·ª•ng</span>
</span></span><span style=display:flex><span>Thread thread1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(<span style=color:#66d9ef>new</span> MyTask());
</span></span><span style=display:flex><span>Thread thread2 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(<span style=color:#66d9ef>new</span> MyTask());
</span></span><span style=display:flex><span>thread1.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>thread2.<span style=color:#a6e22e>start</span>();
</span></span></code></pre></div><h3 id=c√°ch-3-lambda-expression-java-8>C√°ch 3: Lambda Expression (Java 8+)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Thread thread <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 5; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>getName</span>() <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;: &#34;</span> <span style=color:#f92672>+</span> i);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>      Thread.<span style=color:#a6e22e>sleep</span>(1000);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>      e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>thread.<span style=color:#a6e22e>start</span>();
</span></span></code></pre></div><h2 id=thread-lifecycle>Thread Lifecycle</h2><pre tabindex=0><code>NEW ‚Üí RUNNABLE ‚Üí RUNNING ‚Üí TERMINATED
         ‚Üì           ‚Üì
      BLOCKED    WAITING
</code></pre><h2 id=thread-methods>Thread Methods</h2><h3 id=sleep>sleep()</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Thread.<span style=color:#a6e22e>sleep</span>(1000); <span style=color:#75715e>// Sleep 1 gi√¢y</span>
</span></span></code></pre></div><h3 id=join>join()</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Thread t1 <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>  System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Task 1&#34;</span>);
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>t1.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>t1.<span style=color:#a6e22e>join</span>(); <span style=color:#75715e>// Ch·ªù t1 ho√†n th√†nh</span>
</span></span><span style=display:flex><span>System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Task 1 completed&#34;</span>);
</span></span></code></pre></div><h3 id=interrupt>interrupt()</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Thread thread <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Thread(() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (<span style=color:#f92672>!</span>Thread.<span style=color:#a6e22e>interrupted</span>()) {
</span></span><span style=display:flex><span>      System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Working...&#34;</span>);
</span></span><span style=display:flex><span>      Thread.<span style=color:#a6e22e>sleep</span>(1000);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Thread interrupted&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>thread.<span style=color:#a6e22e>start</span>();
</span></span><span style=display:flex><span>Thread.<span style=color:#a6e22e>sleep</span>(3000);
</span></span><span style=display:flex><span>thread.<span style=color:#a6e22e>interrupt</span>(); <span style=color:#75715e>// Ng·∫Øt thread</span>
</span></span></code></pre></div><h2 id=synchronization>Synchronization</h2><h3 id=v·∫•n-ƒë·ªÅ-race-condition>V·∫•n ƒë·ªÅ Race Condition</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Counter</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> count <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>increment</span>() {
</span></span><span style=display:flex><span>    count<span style=color:#f92672>++</span>; <span style=color:#75715e>// Kh√¥ng thread-safe!</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getCount</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> count;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=gi·∫£i-ph√°p-synchronized>Gi·∫£i ph√°p: synchronized</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Counter</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> count <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>increment</span>() {
</span></span><span style=display:flex><span>    count<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getCount</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> count;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=synchronized-block>Synchronized Block</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Counter</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> count <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> Object lock <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Object();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>increment</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>synchronized</span>(lock) {
</span></span><span style=display:flex><span>      count<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=executorservice-modern-approach>ExecutorService (Modern Approach)</h2><h3 id=thread-pool>Thread Pool</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>ExecutorService executor <span style=color:#f92672>=</span> Executors.<span style=color:#a6e22e>newFixedThreadPool</span>(3);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> 10; i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> taskId <span style=color:#f92672>=</span> i;
</span></span><span style=display:flex><span>  executor.<span style=color:#a6e22e>submit</span>(() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>    System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Task &#34;</span> <span style=color:#f92672>+</span> taskId <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; by &#34;</span> <span style=color:#f92672>+</span> 
</span></span><span style=display:flex><span>                      Thread.<span style=color:#a6e22e>currentThread</span>().<span style=color:#a6e22e>getName</span>());
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>executor.<span style=color:#a6e22e>shutdown</span>();
</span></span></code></pre></div><h3 id=callable--future>Callable & Future</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>ExecutorService executor <span style=color:#f92672>=</span> Executors.<span style=color:#a6e22e>newSingleThreadExecutor</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Callable<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> task <span style=color:#f92672>=</span> () <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>  Thread.<span style=color:#a6e22e>sleep</span>(2000);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> 42;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Future<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> future <span style=color:#f92672>=</span> executor.<span style=color:#a6e22e>submit</span>(task);
</span></span><span style=display:flex><span>System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Doing other work...&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Integer result <span style=color:#f92672>=</span> future.<span style=color:#a6e22e>get</span>(); <span style=color:#75715e>// Block cho ƒë·∫øn khi c√≥ k·∫øt qu·∫£</span>
</span></span><span style=display:flex><span>System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Result: &#34;</span> <span style=color:#f92672>+</span> result);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>executor.<span style=color:#a6e22e>shutdown</span>();
</span></span></code></pre></div><h2 id=completablefuture-java-8>CompletableFuture (Java 8+)</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>CompletableFuture<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> future <span style=color:#f92672>=</span> CompletableFuture.<span style=color:#a6e22e>supplyAsync</span>(() <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    Thread.<span style=color:#a6e22e>sleep</span>(2000);
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>    e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Hello&#34;</span>;
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>future.<span style=color:#a6e22e>thenApply</span>(result <span style=color:#f92672>-&gt;</span> result <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; World&#34;</span>)
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>thenAccept</span>(System.<span style=color:#a6e22e>out</span>::println);
</span></span></code></pre></div><h2 id=thread-safe-collections>Thread-Safe Collections</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// Synchronized collections</span>
</span></span><span style=display:flex><span>List<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> syncList <span style=color:#f92672>=</span> Collections.<span style=color:#a6e22e>synchronizedList</span>(<span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>());
</span></span><span style=display:flex><span>Map<span style=color:#f92672>&lt;</span>String, Integer<span style=color:#f92672>&gt;</span> syncMap <span style=color:#f92672>=</span> Collections.<span style=color:#a6e22e>synchronizedMap</span>(<span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Concurrent collections (Better performance)</span>
</span></span><span style=display:flex><span>ConcurrentHashMap<span style=color:#f92672>&lt;</span>String, Integer<span style=color:#f92672>&gt;</span> map <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ConcurrentHashMap<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>CopyOnWriteArrayList<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CopyOnWriteArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>BlockingQueue<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> queue <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LinkedBlockingQueue<span style=color:#f92672>&lt;&gt;</span>();
</span></span></code></pre></div><h2 id=locks-javautilconcurrentlocks>Locks (java.util.concurrent.locks)</h2><h3 id=reentrantlock>ReentrantLock</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Counter</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> count <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> Lock lock <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ReentrantLock();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>increment</span>() {
</span></span><span style=display:flex><span>    lock.<span style=color:#a6e22e>lock</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>      count<span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>      lock.<span style=color:#a6e22e>unlock</span>(); <span style=color:#75715e>// Lu√¥n unlock trong finally</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=readwritelock>ReadWriteLock</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Cache</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> Map<span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;</span> data <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> ReadWriteLock lock <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ReentrantReadWriteLock();
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>get</span>(String key) {
</span></span><span style=display:flex><span>    lock.<span style=color:#a6e22e>readLock</span>().<span style=color:#a6e22e>lock</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> data.<span style=color:#a6e22e>get</span>(key);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>      lock.<span style=color:#a6e22e>readLock</span>().<span style=color:#a6e22e>unlock</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>put</span>(String key, String value) {
</span></span><span style=display:flex><span>    lock.<span style=color:#a6e22e>writeLock</span>().<span style=color:#a6e22e>lock</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>      data.<span style=color:#a6e22e>put</span>(key, value);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>      lock.<span style=color:#a6e22e>writeLock</span>().<span style=color:#a6e22e>unlock</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=best-practices>Best Practices</h2><ol><li><strong>D√πng ExecutorService</strong> thay v√¨ t·∫°o Thread tr·ª±c ti·∫øp</li><li><strong>Tr√°nh synchronized qu√° nhi·ªÅu</strong> - ·∫£nh h∆∞·ªüng performance</li><li><strong>D√πng concurrent collections</strong> khi c·∫ßn thread-safety</li><li><strong>Lu√¥n shutdown ExecutorService</strong> sau khi d√πng</li><li><strong>C·∫©n th·∫≠n v·ªõi deadlock</strong> - lu√¥n lock theo th·ª© t·ª± nh·∫•t qu√°n</li><li><strong>D√πng ThreadLocal</strong> cho thread-specific data</li><li><strong>Test k·ªπ concurrent code</strong> - bugs kh√≥ reproduce</li></ol><h2 id=common-pitfalls>Common Pitfalls</h2><h3 id=deadlock>Deadlock</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// ‚ùå C√≥ th·ªÉ b·ªã deadlock</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>synchronized</span>(lock1) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>synchronized</span>(lock2) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Critical section</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Thread kh√°c</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>synchronized</span>(lock2) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>synchronized</span>(lock1) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Critical section</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=starting-thread-trong-constructor>Starting Thread trong Constructor</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// ‚ùå Nguy hi·ªÉm</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MyClass</span> <span style=color:#66d9ef>extends</span> Thread {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>MyClass</span>() {
</span></span><span style=display:flex><span>    start(); <span style=color:#75715e>// C√≥ th·ªÉ g√¢y v·∫•n ƒë·ªÅ</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=k·∫øt-lu·∫≠n>K·∫øt lu·∫≠n</h2><p>Multithreading gi√∫p t·∫≠n d·ª•ng t·ªëi ƒëa CPU v√† c·∫£i thi·ªán performance. Tuy nhi√™n, c·∫ßn hi·ªÉu r√µ v·ªÅ synchronization v√† concurrent programming ƒë·ªÉ tr√°nh bugs kh√≥ debug!</p><div><div>Tags:</div><ul><li><a href=../../tags/java/>Java</a></li><li><a href=../../tags/concurrency/>Concurrency</a></li></ul></div></main><footer class=footer><div class=container><p>&copy; 2025 D∆∞∆°ng Gia B·∫£o. All rights reserved.</p></div></footer></body></html>