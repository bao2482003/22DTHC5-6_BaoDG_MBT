<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JavaScript Async/Await: Promise nh∆∞ng d·ªÖ ƒë·ªçc h∆°n | Profile</title>
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="icon" href="../../favicon.ico" type="image/x-icon">
</head>
<body>
  <header class="header">
  <div class="container">
    <div class="logo">
      <a href="../../">
        <span class="logo-icon">üè†</span>
        <span class="logo-text">Profile</span>
      </a>
    </div>
    
    <nav class="nav">
      <div class="search-box" onclick="openSearchModal()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <span>T√¨m ki·∫øm...</span>
      </div>
      
      <ul class="menu">
        
        <li><a href="../../#about">V·ªÅ t√¥i</a></li>
        
        <li><a href="../../#experience">Kinh nghi·ªám</a></li>
        
        <li><a href="../../#education">H·ªçc v·∫•n</a></li>
        
        <li><a href="../../#certificates">Ch·ª©ng ch·ªâ</a></li>
        
        <li><a href="../../#contact">Li√™n h·ªá</a></li>
        
        <li><a href="../../#gallery">Th∆∞ vi·ªán ·∫£nh</a></li>
        
        <li><a href="../../posts">Xem b√†i vi·∫øt</a></li>
        
      </ul>
      
      <button class="theme-toggle" aria-label="Toggle dark mode">üåô</button>
    </nav>
  </div>
</header>


<div id="searchModal" class="search-modal">
  <div class="search-modal-content">
    <div class="search-modal-header">
      <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm b√†i vi·∫øt..." autofocus>
      <button onclick="closeSearchModal()" class="search-close">‚úï</button>
    </div>
    <div id="searchResults" class="search-results"></div>
  </div>
</div>

<script>
  let searchIndex = [];
  
  
  fetch('/index.json')
    .then(response => response.json())
    .then(data => {
      searchIndex = data;
    })
    .catch(error => console.log('Search index not loaded'));

  function openSearchModal() {
    document.getElementById('searchModal').style.display = 'flex';
    document.getElementById('searchInput').focus();
    document.body.style.overflow = 'hidden';
  }

  function closeSearchModal() {
    document.getElementById('searchModal').style.display = 'none';
    document.getElementById('searchInput').value = '';
    document.getElementById('searchResults').innerHTML = '';
    document.body.style.overflow = 'auto';
  }

  
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeSearchModal();
    }
  });

  
  document.getElementById('searchModal')?.addEventListener('click', function(e) {
    if (e.target === this) {
      closeSearchModal();
    }
  });

  
  document.getElementById('searchInput')?.addEventListener('input', function(e) {
    const query = e.target.value.toLowerCase().trim();
    const resultsDiv = document.getElementById('searchResults');
    
    if (query.length < 2) {
      resultsDiv.innerHTML = '<p class="search-hint">Nh·∫≠p √≠t nh·∫•t 2 k√Ω t·ª± ƒë·ªÉ t√¨m ki·∫øm...</p>';
      return;
    }

    const results = searchIndex.filter(item => {
      return item.title.toLowerCase().includes(query) ||
             item.content.toLowerCase().includes(query) ||
             (item.tags && item.tags.some(tag => tag.toLowerCase().includes(query)));
    });

    if (results.length === 0) {
      resultsDiv.innerHTML = '<p class="search-no-results">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o.</p>';
      return;
    }

    const html = results.slice(0, 10).map(item => {
      const excerpt = getExcerpt(item.content, query);
      const tagsHtml = item.tags ? item.tags.map(tag => `<span class="result-tag">${tag}</span>`).join('') : '';
      
      return `
        <a href="${item.permalink}" class="search-result-item">
          <h4>${highlightText(item.title, query)}</h4>
          <p class="result-excerpt">${highlightText(excerpt, query)}</p>
          <div class="result-meta">
            <span class="result-date">${formatDate(item.date)}</span>
            ${tagsHtml}
          </div>
        </a>
      `;
    }).join('');

    resultsDiv.innerHTML = html + (results.length > 10 ? `<p class="search-more">C√≤n ${results.length - 10} k·∫øt qu·∫£ n·ªØa...</p>` : '');
  });

  function getExcerpt(content, query) {
    const index = content.toLowerCase().indexOf(query.toLowerCase());
    if (index === -1) {
      return content.substring(0, 150) + '...';
    }
    const start = Math.max(0, index - 50);
    const end = Math.min(content.length, index + 100);
    return (start > 0 ? '...' : '') + content.substring(start, end) + (end < content.length ? '...' : '');
  }

  function highlightText(text, query) {
    const regex = new RegExp(`(${query})`, 'gi');
    return text.replace(regex, '<mark>$1</mark>');
  }

  function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('vi-VN');
  }
</script>

  
  <main>
    <article class="blog-post">
  <div class="post-header">
    <div class="post-breadcrumb">
      <a href="../../posts">‚Üê T·∫•t c·∫£ b√†i vi·∫øt</a>
    </div>
    
    <h1 class="post-title">JavaScript Async/Await: Promise nh∆∞ng d·ªÖ ƒë·ªçc h∆°n</h1>
    
    
    <p class="post-description">X·ª≠ l√Ω b·∫•t ƒë·ªìng b·ªô trong JavaScript v·ªõi async/await</p>
    
    
    <div class="post-meta">
      <div class="meta-left">
        <span class="post-date">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          27/12/2025
        </span>
        <span class="reading-time">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          2 ph√∫t ƒë·ªçc
        </span>
      </div>
      
      <div class="post-tags">
        
        <span class="post-tag">JavaScript</span>
        
        <span class="post-tag">Async</span>
        
      </div>
      
    </div>
  </div>

  <div class="post-content">
    <h2 id="v·∫•n-ƒë·ªÅ-v·ªõi-callback-hell">V·∫•n ƒë·ªÅ v·ªõi Callback Hell</h2>
<p>Tr∆∞·ªõc ƒë√¢y, x·ª≠ l√Ω b·∫•t ƒë·ªìng b·ªô trong JavaScript r·∫•t kh√≥ ƒë·ªçc:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">getData</span>(<span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">a</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">getMoreData</span>(<span style="color:#a6e22e">a</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">b</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">getMoreData</span>(<span style="color:#a6e22e">b</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">c</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">getMoreData</span>(<span style="color:#a6e22e">c</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">d</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">d</span>);
</span></span><span style="display:flex;"><span>      });
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h2 id="promise-gi·∫£i-quy·∫øt-ph·∫ßn-n√†o">Promise gi·∫£i quy·∫øt ph·∫ßn n√†o</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">getData</span>()
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">a</span> =&gt; <span style="color:#a6e22e">getMoreData</span>(<span style="color:#a6e22e">a</span>))
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">b</span> =&gt; <span style="color:#a6e22e">getMoreData</span>(<span style="color:#a6e22e">b</span>))
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">c</span> =&gt; <span style="color:#a6e22e">getMoreData</span>(<span style="color:#a6e22e">c</span>))
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">d</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">d</span>))
</span></span><span style="display:flex;"><span>  .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">error</span> =&gt; <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">error</span>));
</span></span></code></pre></div><h2 id="asyncawait---gi·∫£i-ph√°p-t·ªëi-∆∞u">Async/Await - Gi·∫£i ph√°p t·ªëi ∆∞u</h2>
<p>Async/await gi√∫p code b·∫•t ƒë·ªìng b·ªô tr√¥ng nh∆∞ ƒë·ªìng b·ªô:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">fetchData</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">getData</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">b</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">getMoreData</span>(<span style="color:#a6e22e">a</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">getMoreData</span>(<span style="color:#a6e22e">b</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">getMoreData</span>(<span style="color:#a6e22e">c</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">d</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="c√∫-ph√°p-c∆°-b·∫£n">C√∫ ph√°p c∆° b·∫£n</h2>
<h3 id="khai-b√°o-async-function">Khai b√°o async function</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// Function declaration
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">myFunction</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Hello&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Arrow function
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">myFunction</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Hello&#34;</span>;
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Method
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyClass</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">async</span> <span style="color:#a6e22e">myMethod</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Hello&#34;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="s·ª≠-d·ª•ng-await">S·ª≠ d·ª•ng await</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getUser</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">response</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;/api/user&#39;</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">json</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">data</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="x·ª≠-l√Ω-nhi·ªÅu-promise-song-song">X·ª≠ l√Ω nhi·ªÅu Promise song song</h2>
<h3 id="-ch·∫≠m---ch·ªù-tu·∫ßn-t·ª±">‚ùå Ch·∫≠m - Ch·ªù tu·∫ßn t·ª±</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getData</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">user</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetchUser</span>();      <span style="color:#75715e">// 2s
</span></span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">posts</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetchPosts</span>();    <span style="color:#75715e">// 2s
</span></span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">comments</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetchComments</span>(); <span style="color:#75715e">// 2s
</span></span></span><span style="display:flex;"><span>  <span style="color:#75715e">// T·ªïng: 6s
</span></span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="-nhanh---ch·∫°y-song-song">‚úÖ Nhanh - Ch·∫°y song song</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">getData</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">user</span>, <span style="color:#a6e22e">posts</span>, <span style="color:#a6e22e">comments</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> Promise.<span style="color:#a6e22e">all</span>([
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fetchUser</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fetchPosts</span>(),
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fetchComments</span>()
</span></span><span style="display:flex;"><span>  ]);
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// T·ªïng: 2s (th·ªùi gian c·ªßa request ch·∫≠m nh·∫•t)
</span></span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="error-handling">Error Handling</h2>
<h3 id="trycatch">Try/Catch</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">fetchData</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;/api/data&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">json</span>();
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;L·ªói:&#39;</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="higher-order-function">Higher-order function</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">asyncHandler</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">fn</span>) =&gt; <span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fn</span>(<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>);
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">next</span>(<span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// S·ª≠ d·ª•ng
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">app</span>.<span style="color:#a6e22e">get</span>(<span style="color:#e6db74">&#39;/users&#39;</span>, <span style="color:#a6e22e">asyncHandler</span>(<span style="color:#66d9ef">async</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">users</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">User</span>.<span style="color:#a6e22e">find</span>();
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">json</span>(<span style="color:#a6e22e">users</span>);
</span></span><span style="display:flex;"><span>}));
</span></span></code></pre></div><h2 id="best-practices">Best Practices</h2>
<ol>
<li><strong>Lu√¥n d√πng try/catch</strong> ho·∫∑c <code>.catch()</code> ƒë·ªÉ x·ª≠ l√Ω l·ªói</li>
<li><strong>Ch·∫°y song song khi c√≥ th·ªÉ</strong> v·ªõi <code>Promise.all()</code></li>
<li><strong>Kh√¥ng qu√™n await</strong> - s·∫Ω tr·ªü th√†nh Promise ch∆∞a resolve</li>
<li><strong>C·∫©n th·∫≠n v·ªõi forEach</strong> - d√πng <code>for...of</code> thay v√¨ <code>forEach</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">// ‚ùå Kh√¥ng ho·∫°t ƒë·ªông nh∆∞ mong ƒë·ª£i
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">processArray</span>(<span style="color:#a6e22e">array</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">array</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#66d9ef">async</span> <span style="color:#a6e22e">item</span> =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">processItem</span>(<span style="color:#a6e22e">item</span>);
</span></span><span style="display:flex;"><span>  });
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ‚úÖ ƒê√∫ng c√°ch
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">processArray</span>(<span style="color:#a6e22e">array</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">item</span> <span style="color:#66d9ef">of</span> <span style="color:#a6e22e">array</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">processItem</span>(<span style="color:#a6e22e">item</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="k·∫øt-lu·∫≠n">K·∫øt lu·∫≠n</h2>
<p>Async/await l√†m cho code b·∫•t ƒë·ªìng b·ªô d·ªÖ ƒë·ªçc, d·ªÖ debug v√† d·ªÖ maintain h∆°n r·∫•t nhi·ªÅu so v·ªõi callback v√† promise chains!</p>

  </div>

  
  <div class="comments-section">
    <h3 class="comments-title">üí¨ B√¨nh lu·∫≠n <span id="commentCount"></span></h3>
    
    
    <div class="comment-form">
      <input type="text" id="commentName" placeholder="T√™n c·ªßa b·∫°n" maxlength="50">
      <textarea id="commentText" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." rows="3" maxlength="500"></textarea>
      <button onclick="addComment()" class="submit-comment">G·ª≠i b√¨nh lu·∫≠n</button>
    </div>

    
    <div class="comment-filter">
      <button onclick="filterComments('top')" class="filter-btn active" id="filter-top">üëç Ch·∫•t l∆∞·ª£ng nh·∫•t</button>
      <button onclick="filterComments('newest')" class="filter-btn" id="filter-newest">üïê M·ªõi nh·∫•t</button>
    </div>

    
    <div id="commentsList" class="comments-list"></div>
    
    <button id="showAllBtn" class="show-all-btn" onclick="showAllComments()" style="display:none;">
      Xem t·∫•t c·∫£ b√¨nh lu·∫≠n
    </button>
  </div>

  
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

  <script>
    
    const firebaseConfig = {
  apiKey: "AIzaSyAdjhCEVyCd-Lr5M6wIrcVIdUGZK5nnMRQ",
  authDomain: "project-profile-e5576.firebaseapp.com",
  databaseURL: "https://project-profile-e5576-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "project-profile-e5576",
  storageBucket: "project-profile-e5576.firebasestorage.app",
  messagingSenderId: "141833177870",
  appId: "1:141833177870:web:510eb87ec5b5749d9e255f",
  measurementId: "G-8EZ42LZQ09"
};

    
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    const POST_ID = '\/posts\/javascript-async-await\/'.replace(/\//g, '_');
    let currentFilter = 'top';
    let showAll = false;
    let commentsCache = [];

    function getComments() {
      return commentsCache;
    }

    function loadCommentsFromFirebase() {
      const commentsRef = database.ref('comments/' + POST_ID);
      commentsRef.on('value', (snapshot) => {
        const data = snapshot.val();
        if (data) {
          commentsCache = Object.values(data).map(comment => ({
            ...comment,
            likedBy: comment.likedBy || [],
            likes: comment.likes || 0
          }));
        } else {
          commentsCache = [];
        }
        renderComments();
      });
    }

    function addComment() {
      const name = document.getElementById('commentName').value.trim();
      const text = document.getElementById('commentText').value.trim();
      
      if (!name || !text) {
        alert('Vui l√≤ng nh·∫≠p t√™n v√† n·ªôi dung b√¨nh lu·∫≠n!');
        return;
      }

      const newComment = {
        id: Date.now(),
        name: name,
        text: text,
        likes: 0,
        timestamp: new Date().toISOString(),
        likedBy: []
      };

      
      const commentsRef = database.ref('comments/' + POST_ID);
      commentsRef.push(newComment).then(() => {
        document.getElementById('commentName').value = '';
        document.getElementById('commentText').value = '';
      }).catch((error) => {
        alert('L·ªói khi g·ª≠i b√¨nh lu·∫≠n: ' + error.message);
      });
    }

    function likeComment(commentId) {
      const userId = getUserId();
      const commentsRef = database.ref('comments/' + POST_ID);
      
      commentsRef.once('value').then((snapshot) => {
        const comments = snapshot.val();
        if (!comments) return;
        
        
        let commentKey = null;
        let comment = null;
        
        Object.keys(comments).forEach(key => {
          if (comments[key].id === commentId) {
            commentKey = key;
            comment = comments[key];
          }
        });
        
        if (comment && commentKey) {
          const likedBy = comment.likedBy || [];
          const likedIndex = likedBy.indexOf(userId);
          
          if (likedIndex > -1) {
            likedBy.splice(likedIndex, 1);
            comment.likes = Math.max(0, (comment.likes || 0) - 1);
          } else {
            likedBy.push(userId);
            comment.likes = (comment.likes || 0) + 1;
          }
          
          comment.likedBy = likedBy;
          
          
          database.ref('comments/' + POST_ID + '/' + commentKey).set(comment);
        }
      });
    }

    function getUserId() {
      let userId = localStorage.getItem('userId');
      if (!userId) {
        userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('userId', userId);
      }
      return userId;
    }

    function formatDate(timestamp) {
      const date = new Date(timestamp);
      const now = new Date();
      const diff = Math.floor((now - date) / 1000);

      if (diff < 60) return 'v·ª´a xong';
      if (diff < 3600) return Math.floor(diff / 60) + ' ph√∫t tr∆∞·ªõc';
      if (diff < 86400) return Math.floor(diff / 3600) + ' gi·ªù tr∆∞·ªõc';
      if (diff < 2592000) return Math.floor(diff / 86400) + ' ng√†y tr∆∞·ªõc';
      
      return date.toLocaleDateString('vi-VN');
    }

    function filterComments(filter) {
      currentFilter = filter;
      
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById('filter-' + filter).classList.add('active');
      
      renderComments();
    }

    function showAllComments() {
      showAll = true;
      renderComments();
    }

    function renderComments() {
      let comments = getComments();
      
      
      const countSpan = document.getElementById('commentCount');
      if (comments.length > 0) {
        countSpan.textContent = `(${comments.length})`;
      } else {
        countSpan.textContent = '';
      }
      
      if (currentFilter === 'top') {
        comments.sort((a, b) => b.likes - a.likes);
      } else {
        comments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      }

      const userId = getUserId();
      const displayComments = showAll ? comments : comments.slice(0, 3);
      
      const html = displayComments.map(comment => {
        const likedBy = comment.likedBy || [];
        const likes = comment.likes || 0;
        const hasLiked = likedBy.includes(userId);
        return `
          <div class="comment-item">
            <div class="comment-avatar">${comment.name.charAt(0).toUpperCase()}</div>
            <div class="comment-content">
              <div class="comment-header">
                <strong>${comment.name}</strong>
                <span class="comment-time">${formatDate(comment.timestamp)}</span>
              </div>
              <p class="comment-text">${comment.text}</p>
              <button onclick="likeComment(${comment.id})" class="like-btn ${hasLiked ? 'liked' : ''}">
                ‚ù§Ô∏è ${likes}
              </button>
            </div>
          </div>
        `;
      }).join('');

      document.getElementById('commentsList').innerHTML = html || '<p class="no-comments">Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>';
      
      const showAllBtn = document.getElementById('showAllBtn');
      if (comments.length > 3 && !showAll) {
        showAllBtn.style.display = 'block';
        showAllBtn.textContent = `Xem t·∫•t c·∫£ ${comments.length} b√¨nh lu·∫≠n`;
      } else {
        showAllBtn.style.display = 'none';
      }
    }

    
    loadCommentsFromFirebase();
  </script>

  <div class="post-footer">
    <a href="../../posts" class="back-to-blog">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      Xem t·∫•t c·∫£ b√†i vi·∫øt
    </a>
  </div>
</article>
  </main>
  
  <footer class="footer">
  <div class="container">
    <p>&copy; 2025 D∆∞∆°ng Gia B·∫£o. All rights reserved.</p>
  </div>
</footer>

</body>
</html>
