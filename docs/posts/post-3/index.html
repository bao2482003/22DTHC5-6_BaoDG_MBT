<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Post 3 | Profile</title>
  <link rel="stylesheet" href="../../css/style.css">
  <link rel="icon" href="../../favicon.ico" type="image/x-icon">
</head>
<body>
  <header class="header">
  <div class="container">
    <div class="logo">
      <a href="../../">
        <span class="logo-icon">üè†</span>
        <span class="logo-text">Profile</span>
      </a>
    </div>
    
    <nav class="nav">
      <div class="search-box">
        <span>T√¨m ki·∫øm...</span>
      </div>
      
      <ul class="menu">
        
        <li><a href="../../#about">V·ªÅ t√¥i</a></li>
        
        <li><a href="../../#experience">Kinh nghi·ªám</a></li>
        
        <li><a href="../../#education">H·ªçc v·∫•n</a></li>
        
        <li><a href="../../#certificates">Ch·ª©ng ch·ªâ</a></li>
        
        <li><a href="../../#contact">Li√™n h·ªá</a></li>
        
        <li><a href="../../posts">Blog</a></li>
        
        <li><a href="../../#gallery">Th∆∞ vi·ªán ·∫£nh</a></li>
        
      </ul>
      
      <button class="theme-toggle" aria-label="Toggle dark mode">üåô</button>
    </nav>
  </div>
</header>

  
  <main>
    <article class="blog-post">
  <div class="post-header">
    <div class="post-breadcrumb">
      <a href="../../posts">‚Üê T·∫•t c·∫£ b√†i vi·∫øt</a>
    </div>
    
    <h1 class="post-title">Post 3</h1>
    
    
    
    <div class="post-meta">
      <div class="meta-left">
        <span class="post-date">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          15/03/2023
        </span>
        <span class="reading-time">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          1 ph√∫t ƒë·ªçc
        </span>
      </div>
      
      <div class="post-tags">
        
        <span class="post-tag">red</span>
        
        <span class="post-tag">green</span>
        
        <span class="post-tag">blue</span>
        
      </div>
      
    </div>
  </div>

  <div class="post-content">
    <p>Occaecat aliqua consequat laborum ut ex aute aliqua culpa quis irure esse magna dolore quis. Proident fugiat labore eu laboris officia Lorem enim. Ipsum occaecat cillum ut tempor id sint aliqua incididunt nisi incididunt reprehenderit. Voluptate ad minim sint est aute aliquip esse occaecat tempor officia qui sunt. Aute ex ipsum id ut in est velit est laborum incididunt. Aliqua qui id do esse sunt eiusmod id deserunt eu nostrud aute sit ipsum. Deserunt esse cillum Lorem non magna adipisicing mollit amet consequat.</p>
<p><img src="bryce-canyon.jpg" alt="Bryce Canyon National Park"></p>
<p>Sit excepteur do velit veniam mollit in nostrud laboris incididunt ea. Amet eu cillum ut reprehenderit culpa aliquip labore laborum amet sit sit duis. Laborum id proident nostrud dolore laborum reprehenderit quis mollit nulla amet veniam officia id id. Aliquip in deserunt qui magna duis qui pariatur officia sunt deserunt.</p>

  </div>

  
  <div class="comments-section">
    <h3 class="comments-title">üí¨ B√¨nh lu·∫≠n <span id="commentCount"></span></h3>
    
    
    <div class="comment-form">
      <input type="text" id="commentName" placeholder="T√™n c·ªßa b·∫°n" maxlength="50">
      <textarea id="commentText" placeholder="Vi·∫øt b√¨nh lu·∫≠n c·ªßa b·∫°n..." rows="3" maxlength="500"></textarea>
      <button onclick="addComment()" class="submit-comment">G·ª≠i b√¨nh lu·∫≠n</button>
    </div>

    
    <div class="comment-filter">
      <button onclick="filterComments('top')" class="filter-btn active" id="filter-top">üëç Ch·∫•t l∆∞·ª£ng nh·∫•t</button>
      <button onclick="filterComments('newest')" class="filter-btn" id="filter-newest">üïê M·ªõi nh·∫•t</button>
    </div>

    
    <div id="commentsList" class="comments-list"></div>
    
    <button id="showAllBtn" class="show-all-btn" onclick="showAllComments()" style="display:none;">
      Xem t·∫•t c·∫£ b√¨nh lu·∫≠n
    </button>
  </div>

  
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

  <script>
    
    const firebaseConfig = {
  apiKey: "AIzaSyAdjhCEVyCd-Lr5M6wIrcVIdUGZK5nnMRQ",
  authDomain: "project-profile-e5576.firebaseapp.com",
  databaseURL: "https://project-profile-e5576-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "project-profile-e5576",
  storageBucket: "project-profile-e5576.firebasestorage.app",
  messagingSenderId: "141833177870",
  appId: "1:141833177870:web:510eb87ec5b5749d9e255f",
  measurementId: "G-8EZ42LZQ09"
};

    
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    const POST_ID = '\/posts\/post-3\/'.replace(/\//g, '_');
    let currentFilter = 'top';
    let showAll = false;
    let commentsCache = [];

    function getComments() {
      return commentsCache;
    }

    function loadCommentsFromFirebase() {
      const commentsRef = database.ref('comments/' + POST_ID);
      commentsRef.on('value', (snapshot) => {
        const data = snapshot.val();
        commentsCache = data ? Object.values(data) : [];
        renderComments();
      });
    }

    function addComment() {
      const name = document.getElementById('commentName').value.trim();
      const text = document.getElementById('commentText').value.trim();
      
      if (!name || !text) {
        alert('Vui l√≤ng nh·∫≠p t√™n v√† n·ªôi dung b√¨nh lu·∫≠n!');
        return;
      }

      const newComment = {
        id: Date.now(),
        name: name,
        text: text,
        likes: 0,
        timestamp: new Date().toISOString(),
        likedBy: []
      };

      
      const commentsRef = database.ref('comments/' + POST_ID);
      commentsRef.push(newComment).then(() => {
        document.getElementById('commentName').value = '';
        document.getElementById('commentText').value = '';
      }).catch((error) => {
        alert('L·ªói khi g·ª≠i b√¨nh lu·∫≠n: ' + error.message);
      });
    }

    function likeComment(commentId) {
      const userId = getUserId();
      const commentsRef = database.ref('comments/' + POST_ID);
      
      commentsRef.once('value').then((snapshot) => {
        const comments = snapshot.val();
        if (!comments) return;
        
        
        let commentKey = null;
        let comment = null;
        
        Object.keys(comments).forEach(key => {
          if (comments[key].id === commentId) {
            commentKey = key;
            comment = comments[key];
          }
        });
        
        if (comment && commentKey) {
          const likedBy = comment.likedBy || [];
          const likedIndex = likedBy.indexOf(userId);
          
          if (likedIndex > -1) {
            likedBy.splice(likedIndex, 1);
            comment.likes = Math.max(0, (comment.likes || 0) - 1);
          } else {
            likedBy.push(userId);
            comment.likes = (comment.likes || 0) + 1;
          }
          
          comment.likedBy = likedBy;
          
          
          database.ref('comments/' + POST_ID + '/' + commentKey).set(comment);
        }
      });
    }

    function getUserId() {
      let userId = localStorage.getItem('userId');
      if (!userId) {
        userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('userId', userId);
      }
      return userId;
    }

    function formatDate(timestamp) {
      const date = new Date(timestamp);
      const now = new Date();
      const diff = Math.floor((now - date) / 1000);

      if (diff < 60) return 'v·ª´a xong';
      if (diff < 3600) return Math.floor(diff / 60) + ' ph√∫t tr∆∞·ªõc';
      if (diff < 86400) return Math.floor(diff / 3600) + ' gi·ªù tr∆∞·ªõc';
      if (diff < 2592000) return Math.floor(diff / 86400) + ' ng√†y tr∆∞·ªõc';
      
      return date.toLocaleDateString('vi-VN');
    }

    function filterComments(filter) {
      currentFilter = filter;
      
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById('filter-' + filter).classList.add('active');
      
      renderComments();
    }

    function showAllComments() {
      showAll = true;
      renderComments();
    }

    function renderComments() {
      let comments = getComments();
      
      
      const countSpan = document.getElementById('commentCount');
      if (comments.length > 0) {
        countSpan.textContent = `(${comments.length})`;
      } else {
        countSpan.textContent = '';
      }
      
      if (currentFilter === 'top') {
        comments.sort((a, b) => b.likes - a.likes);
      } else {
        comments.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
      }

      const userId = getUserId();
      const displayComments = showAll ? comments : comments.slice(0, 3);
      
      const html = displayComments.map(comment => {
        const hasLiked = comment.likedBy.includes(userId);
        return `
          <div class="comment-item">
            <div class="comment-avatar">${comment.name.charAt(0).toUpperCase()}</div>
            <div class="comment-content">
              <div class="comment-header">
                <strong>${comment.name}</strong>
                <span class="comment-time">${formatDate(comment.timestamp)}</span>
              </div>
              <p class="comment-text">${comment.text}</p>
              <button onclick="likeComment(${comment.id})" class="like-btn ${hasLiked ? 'liked' : ''}">
                ‚ù§Ô∏è ${comment.likes}
              </button>
            </div>
          </div>
        `;
      }).join('');

      document.getElementById('commentsList').innerHTML = html || '<p class="no-comments">Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>';
      
      const showAllBtn = document.getElementById('showAllBtn');
      if (comments.length > 3 && !showAll) {
        showAllBtn.style.display = 'block';
        showAllBtn.textContent = `Xem t·∫•t c·∫£ ${comments.length} b√¨nh lu·∫≠n`;
      } else {
        showAllBtn.style.display = 'none';
      }
    }

    
    loadCommentsFromFirebase();
  </script>

  <div class="post-footer">
    <a href="../../posts" class="back-to-blog">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      Xem t·∫•t c·∫£ b√†i vi·∫øt
    </a>
  </div>
</article>
  </main>
  
  <footer class="footer">
  <div class="container">
    <p>&copy; 2025 D∆∞∆°ng Gia B·∫£o. All rights reserved.</p>
  </div>
</footer>

</body>
</html>
